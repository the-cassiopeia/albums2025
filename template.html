<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width,initial-scale=1.0" name="viewport">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Sans+3&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBmaWxsPSIjYzgzNzM3IiBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiLz48ZyB0cmFuc2Zvcm09Im1hdHJpeCguMDMyODE2NjEgMCAwIC4wMzM2NDAwMyA1LjQxNjQ5MTkgNi42ODQ0NjcpIiBmaWxsPSIjZmZhYWFhIj48cGF0aCBkPSJNMjk3LjMgNTUwLjg3Yy0xMy43OC0xNS40NC00OC4xNy00NS41My03Ni40NC02Ni44Ny04My43NC02My4yNS05NS4xNC03Mi40LTEyOS4xNC0xMDMuNzEtNjIuNjgtNTcuNzItODkuMzEtMTE1LjcxLTg5LjIyLTE5NC4zNC4wNC0zOC4zOCAyLjY2LTUzLjE3IDEzLjQxLTc1LjggMTguMjQtMzguMzkgNDUuMS02Ni45MSA3OS40NS04NC4zNiAyNC4zMi0xMi4zNiAzNi4zMi0xNy44NCA3Ni45NC0xOC4wNyA0Mi40OS0uMjMgNTEuNDQgNC43MiA3Ni40MyAxOC40NSAzMC40MiAxNi43MSA2MS43NCA1Mi40NCA2OC4yMSA3Ny44MWwzLjEgMTUuNjcgOS44Ni0yMS41OGM1NS43Mi0xMjEuOTcgMjMzLjYtMTIwLjE1IDI5NS41IDMuMDMgMTkuNjQgMzkuMDggMjEuNzkgMTIyLjUxIDQuMzggMTY5LjUxLTIyLjcyIDYxLjMxLTY1LjM4IDEwOC4wNS0xNjQuMDEgMTc5LjY4LTY0LjY4IDQ2Ljk3LTEzNy44OCAxMTguMDUtMTQyLjk4IDEyOC4wMy01LjkyIDExLjU5LS4yOCAxLjgyLTI2LjQxLTI3LjQ2eiIvPjwvZz48L3N2Zz4=">
    <title>Album Ratings</title>
    <style>
        body {
            color: #EDEDED;
            background: #161616;
            width: 620px;
            margin: 0 auto;
            padding: 0;
            font-family: 'Source Sans 3', sans-serif;
        }

        .container {
            max-width: 100%;
        }

        h2 {
            color: #5cb85c;
            font-size: 1.2rem;
            margin: 0;
        }

        .album-list {
            counter-reset: album-counter;
            display: flex;
            flex-direction: column;
            padding: 0;
            list-style: none;
        }

        .album-list li {
            counter-increment: album-counter;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px 3px 42px;
            font-size: 1rem;
            position: relative;
        }

        .album-list li:hover {
            background: #2d2d2d;
            box-shadow: 0 0 12px rgba(45, 45, 45, 0.9);
        }

        .album-list li::before {
            content: counter(album-counter) ".";
            color: #5cb85c;
            font-weight: bold;
            position: absolute;
            left: 10px;
        }

        .rating {
            color: #5cb85c;
            margin-left: 6px;
            font-weight: bold;
        }

        .rating-info-trigger {
            cursor: help;
            color: #EDEDED;
            background: #5cb85c;
            user-select: none;
            border: none;
            border-radius: 50%;
            width: 1.1em;
            height: 1.1em;
            margin-left: 8px;
            font-size: .95em;
            font-weight: bold;
            line-height: 1.1em;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .rating-tooltip {
            color: #ededed;
            z-index: 100;
            text-align: left;
            background: #2d2d2d;
            box-shadow: 0 0 12px rgba(45, 45, 45, 0.9);
            border-radius: 10px;
            width: 320px;
            padding: 5px 10px;
            display: none;
            position: absolute;
            top: 125%;
            left: 50%;
            transform: translate(-50%);
        }

        .rating-tooltip p {
            margin: 5px 0;
        }

        .rating-tooltip p strong {
            color: #5cb85c;
        }

        .rating-info-trigger:is(:hover, :focus, :focus-within) .rating-tooltip {
            display: block;
        }

        .genre {
            color: #888;
            margin-left: auto;
            font-size: .8rem;
            font-style: italic;
        }

        .YT {
            display: inline-block;
            width: 1.3em;
            height: 1.3em;
            background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+PGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMzAiIGZpbGw9IiNjZDFjMWMiLz48cG9seWdvbiBwb2ludHM9IjIyLDE2IDQ4LDMyIDIyLDQ4IiBmaWxsPSIjZmZmIi8+PC9zdmc+) 0 0 / contain no-repeat;
            vertical-align: text-top;
        }

        .YT:hover {
            filter: brightness(1.2);
            transform: scale(1.2);
        }

        .filter-container {
            justify-content: center;
            align-items: center;
            margin: 15px 0;
            display: flex
        }

        .genre-labels-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
            margin-bottom: 15px;
        }

        .genre-label {
            padding: 2px 6px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: transform 0.15s ease, box-shadow 0.15s ease, outline 0.15s ease;
            line-height: 1.3;
            user-select: none;
        }

        .genre-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }

        .genre-label.active {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
            outline: 2px solid #ededed;
            outline-offset: 1px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="filter-container">
            <h2>
                2025 Album Ranking
                <span class="rating-info-trigger" id="ratingInfoTrigger" role="tooltip" tabindex="0">
                    ?
                    <div class="rating-tooltip" id="ratingTooltip">
                        <p><strong>Rating Scheme</strong></p>
                        <p><strong>5/5</strong> - amazing - AOTY contender</p>
                        <p><strong>4/5</strong> - great - very memorable</p>
                        <p><strong>3/5</strong> - pretty good - would listen again</p>
                        <p><strong>2/5</strong> - forgettable - won't listen again</p>
                        <p><strong>1/5</strong> - bad - has major issues</p>
                    </div>
                </span>
            </h2>
        </div>
        <ol class="album-list">
            <!--PLACEHOLDER_ALBUM_LIST-->
        </ol>
    </div>
    <script defer>
        const albumData = [];
        const activeGenreFilters = new Set();
        const genreLabelElements = new Map();

        const elements = {
            albumList: document.querySelector('.album-list'),
            filterContainer: document.querySelector('.filter-container'),
            ratingInfoTrigger: document.getElementById('ratingInfoTrigger')
        };

        const genreColors = [
            '#4782C0', '#47A082', '#8247C0', '#C08247', '#C04782', '#47C0C0',
            '#377A3A', '#C09000', '#B7302A', '#1770B7', '#005A5A', '#631FAD',
            '#886008', '#AE5C5C', '#5A4BAE', '#2C8252', '#C0A400', '#903E9F',
            '#346086', '#974343', '#17827B', '#9F7D17', '#C04A36', '#668B66'
        ];

        function initializeAlbumData() {
            if (!elements.albumList) return;
            albumData.push(...Array.from(elements.albumList.querySelectorAll('li'), element => {
                const genreText = element.querySelector('.genre')?.textContent.toLowerCase() || '';
                return {
                    element,
                    genreArray: genreText ? genreText.split('/').map(g => g.trim()).filter(Boolean) : []
                };
            }));
        }

        function getContrastColor(hexColor) {
            const hex = hexColor.slice(1);
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            return (r * 299 + g * 587 + b * 114) / 1000 >= 128 ? '#161616' : '#ededed';
        }

        function extractGenres() {
            const genreCounts = new Map();

            albumData.flatMap(({ genreArray }) => genreArray)
                .forEach(genre => {
                    const lowerGenre = genre.toLowerCase();
                    const existing = genreCounts.get(lowerGenre);

                    if (existing) {
                        existing.count++;
                        if (genre.length < existing.originalCase.length) {
                            existing.originalCase = genre;
                        }
                    } else {
                        genreCounts.set(lowerGenre, { count: 1, originalCase: genre });
                    }
                });

            return Array.from(genreCounts.entries(), ([lowerName, { count, originalCase }]) => ({
                name: originalCase,
                lowerName,
                count
            })).sort((a, b) => b.count - a.count || a.name.localeCompare(b.name));
        }

        function createGenreLabel(genre, index) {
            const label = document.createElement('span');
            const color = genreColors[index % genreColors.length];

            Object.assign(label, {
                className: 'genre-label',
                textContent: `${genre.name} (${genre.count})`
            });

            label.setAttribute('data-genre', genre.lowerName);
            Object.assign(label.style, {
                backgroundColor: color,
                color: getContrastColor(color)
            });

            genreLabelElements.set(genre.lowerName, label);
            return label;
        }

        function setupGenreLabels() {
            if (!albumData.length || !elements.albumList || !elements.filterContainer) return;

            const genres = extractGenres();
            if (genres.length === 0) return;

            const container = document.createElement('div');
            container.className = 'genre-labels-container';

            container.addEventListener('click', (e) => {
                const label = e.target.closest('.genre-label');
                if (!label) return;

                const genreName = label.getAttribute('data-genre');
                if (activeGenreFilters.has(genreName)) {
                    activeGenreFilters.delete(genreName);
                } else {
                    activeGenreFilters.add(genreName);
                }
                filterByGenre();
            });

            const fragment = document.createDocumentFragment();
            genres.forEach((genre, index) => {
                fragment.appendChild(createGenreLabel(genre, index));
            });
            container.appendChild(fragment);

            elements.filterContainer.parentNode.insertBefore(container, elements.albumList);
        }

        function filterByGenre() {
            for (const [genreName, label] of genreLabelElements) {
                label.classList.toggle('active', activeGenreFilters.has(genreName));
            }

            const hasActiveFilters = activeGenreFilters.size > 0;

            for (const { element, genreArray } of albumData) {
                const shouldShow = !hasActiveFilters || genreArray.some(genre => activeGenreFilters.has(genre));
                element.style.display = shouldShow ? 'flex' : 'none';
            }
        }

        function setupYouTubeLinks() {
            document.querySelectorAll('a.YT').forEach(link => {
                link.target = '_blank';
                link.rel = 'noopener';
            });
        }

        function setupTooltipBehavior() {
            if (!elements.ratingInfoTrigger) return;

            document.addEventListener('click', (e) => {
                if (!elements.ratingInfoTrigger.contains(e.target)) {
                    elements.ratingInfoTrigger.blur();
                }
            }, { passive: true });
        }

        function init() {
            initializeAlbumData();
            setupGenreLabels();
            filterByGenre();
            setupYouTubeLinks();
            setupTooltipBehavior();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>

</html>